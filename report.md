{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "85e19742",
   "metadata": {},
   "source": [
    "\n",
    "\n",
    "```commandline\n",
    "python ./dataprep/evaluation_fonciere.py   ===> **eval_cleaned.csv** (to drop later if it doesn't crash the code of others)+ for feature engineering use **eval_cleaned_feat_eng.csv**\n",
    "\n",
    "\n",
    "# üîç Summary of Code Workflow\n",
    "\n",
    "This script performs **data cleaning** and **feature engineering** on the Montr√©al property evaluation dataset (`uniteevaluationfonciere.csv`). The goal is to prepare a high-quality dataset for fire risk modeling by cleaning critical variables, imputing missing values intelligently, and generating informative derived features.\n",
    "\n",
    "### ‚úÖ Main Steps:\n",
    "1. **Read raw data** from CSV.\n",
    "2. **Clean key columns**: `ANNEE_CONSTRUCTION`, `NOMBRE_LOGEMENT`, `ETAGE_HORS_SOL`, and `SUPERFICIE_BATIMENT`.\n",
    "3. **Impute missing values** using borough-level and building-type-level medians.\n",
    "4. **Engineer new features**:\n",
    "   - `AGE_BATIMENT`\n",
    "   - `RATIO_SURFACE`\n",
    "   - `DENSITE_LOGEMENT`\n",
    "   - `HAS_MULTIPLE_LOGEMENTS`\n",
    "   - `FIRE_FREQUENCY_ZONE`\n",
    "5. **Normalize numeric features** using MinMaxScaler.\n",
    "6. **Export** the cleaned and enriched dataset to `eval_cleaned_feat_eng.csv`.\n",
    "\n",
    "---\n",
    "\n",
    "# üßπ Data Cleaning & Feature Engineering Summary\n",
    "\n",
    "## üìå Data Cleaning Summary\n",
    "\n",
    "| Column                | Cleaning Strategy                                                                 |\n",
    "|-----------------------|------------------------------------------------------------------------------------|\n",
    "| `ANNEE_CONSTRUCTION`  | - Removed unrealistic values (<1800 or >2025)  \n",
    "                           - Imputed by borough median for \"Logement/Immeuble\"  \n",
    "                           - Fallback: `\"unknown\"` |\n",
    "| `NOMBRE_LOGEMENT`     | - Imputed using median by `(borough, building type)`  \n",
    "                           - Fallback: borough-level median |\n",
    "| `ETAGE_HORS_SOL`      | - Imputed using median by `(borough, building type)`  \n",
    "                           - Fallback: borough-level median |\n",
    "| `SUPERFICIE_BATIMENT` | - Imputed using median by `(borough, building type)`  \n",
    "                           - Fallback: borough-level median |\n",
    "\n",
    "---\n",
    "\n",
    "## üèóÔ∏è Feature Engineering Summary\n",
    "\n",
    "| Feature Name             | Description                                                                 |\n",
    "|--------------------------|-----------------------------------------------------------------------------|\n",
    "| `AGE_BATIMENT`           | Building age = 2025 - construction year                                      |\n",
    "| `RATIO_SURFACE`          | `SUPERFICIE_BATIMENT` / `SUPERFICIE_TERRAIN`                                 |\n",
    "| `DENSITE_LOGEMENT`       | `NOMBRE_LOGEMENT` / `SUPERFICIE_BATIMENT`                                    |\n",
    "| `HAS_MULTIPLE_LOGEMENTS` | Binary flag: 1 if more than one housing unit, 0 otherwise                    |\n",
    "| `FIRE_FREQUENCY_ZONE`    | Proxy for fire risk: number of buildings in the same `NO_ARROND_ILE_CUM`     |\n",
    "\n",
    "> All continuous features were normalized using **MinMaxScaler**.\n",
    "\n",
    "---\n",
    "\n",
    "## üóÉÔ∏è Dropped or Excluded Columns\n",
    "\n",
    "Temporary or unused columns were dropped before final export:\n",
    "\n",
    "- `_ANNEE_CONSTRUCTION_NUM` (intermediate)\n",
    "- Future features like `IS_UNKNOWN_YEAR`, `IS_MIXED_USE`, etc.\n",
    "- Any columns used only during cleaning/imputation logic\n",
    "\n",
    "---\n",
    "\n",
    "## üì¶ Final Output Columns\n",
    "\n",
    "The following columns are present in the output file `eval_cleaned_feat_eng.csv`:\n",
    "\n",
    "```text\n",
    "[\n",
    " 'ID_UEV', 'CIVIQUE_DEBUT', 'CIVIQUE_FIN', 'NOM_RUE', 'SUITE_DEBUT', 'MUNICIPALITE',\n",
    " 'ETAGE_HORS_SOL', 'NOMBRE_LOGEMENT', 'ANNEE_CONSTRUCTION', 'CODE_UTILISATION',\n",
    " 'LETTRE_DEBUT', 'LETTRE_FIN', 'LIBELLE_UTILISATION', 'CATEGORIE_UEF', 'MATRICULE83',\n",
    " 'SUPERFICIE_TERRAIN', 'SUPERFICIE_BATIMENT', 'NO_ARROND_ILE_CUM',\n",
    " 'AGE_BATIMENT', 'RATIO_SURFACE', 'DENSITE_LOGEMENT',\n",
    " 'HAS_MULTIPLE_LOGEMENTS', 'FIRE_FREQUENCY_ZONE'\n",
    "]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "954e8fb3",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
